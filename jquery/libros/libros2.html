<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alexandria">
    <title>Visualizador libros</title>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="libros.css">
    <title>Libros por nombre</title>
</head>
<body>/* Hacerlo  que busque los libros por titulo*/
    <div class="contendor">
        <div class="formulario">
            <h1>Gutendex API</h1>
            <label for="codlibro">Código Libro:</label>
            <input type="number" name="codLibro" id="codLibro" min="1">
            <br>
            <label for="titlibro">Titulo Libro:</label>
            <input type="text" name="titlibro" id="titulolibro">
            <label for="botones">Acción:</label>
            <button id="btn-libro">Obtener libro pot codigo</button>
            <button id="btn-librotitulo">Obtener libro por titulo </button>
            <button id="btn-todos">Ver todos</button>
            <div id="resultados">
                <!-- Aqui cargaremos los resultados-->
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
                $.get("https://gutendex.com/books/").done(function (resp){
                    let num_libros = resp.results.length;
                    $( function (){

                        let availableTags =[];
                        for (let i=0; i<num_libros; i++){
                            let respuesta = new Object(resp.results[i]);
                            let titulo = respuesta.title;
                            let autor = respuesta.authors.length == 0 ? "Anónimo" : respuesta.authors[0].name;
                            let imagen = respuesta.formats['image/jpeg'];
                            let enlace = respuesta.formats['text/plain; charset=us-ascii'];
                            let numeroDescargas = respuesta.download_count;
                            availableTags[i]= respuesta.title;
                        }
                        $("#titulolibro").autocomplete({source: availableTags});
                        
                    });
                    
                });
            
                $("#btn-todos").click(function (e) { 
                e.preventDefault();
                $.get("https://gutendex.com/books/").done(function (r){
                    let num_libros = r.results.length;
                    $("#resultados").empty();
                        for (let i=0; i<num_libros; i++){
                            let respuesta = new Object(r.results[i]);
                            let titulo = respuesta.title;
                            let autor = respuesta.authors.length == 0 ? "Anónimo" : respuesta.authors[0].name;
                            let imagen = respuesta.formats['image/jpeg'];
                            let enlace = respuesta.formats['text/plain; charset=us-ascii'];
                            let numeroDescargas = respuesta.download_count;
                            $('#resultados').append(
                            '<p>'+'<img width="120" src="'+imagen+'"></p>' +
                            '<p>Título: '+titulo+'</p>' + 
                            '<p>Autor: '+autor+'</p>' + 
                            '<p><a href="'+enlace+'" target="_blank">Descarga aquí</a></p>' + 
                            '<p>Nº descargas: ' + numeroDescargas + '</p>');
                        }
                    });
                });
                $("#btn-libro").click(function(){
                    let codigo = $("#codLibro").val();
                    $.get("https://gutendex.com/books/"+codigo).done(function (respuesta){
                        console.log(respuesta);
                        let titulo = respuesta.title;
                        let autor = respuesta.authors.length == 0 ? "Anónimo" : respuesta.authors[0].name;
                        let imagen = respuesta.formats['image/jpeg'];
                        let enlace = respuesta.formats['text/plain; charset=us-ascii'];
                        let numeroDescargas = respuesta.download_count;
                        $("#resultados").empty();
                        $('#resultados').append(
                            '<p>'+'<img width="120" src="'+imagen+'"></p>' +
                            '<p>Título: '+titulo+'</p>' + 
                            '<p>Autor: '+autor+'</p>' + 
                            '<p><a href="'+enlace+'" target="_blank">Descarga aquí</a></p>' + 
                            '<p>Nº descargas: ' + numeroDescargas + '</p>');
                    }).fail(function (respuesta){
                        alert("Error en este libro");
                    });

                });
                $("#btn-librotitulo").click(function () { 
                   let longitud = resp.results.length;

                   for (let i=0;i<longitud;i++)
                   {
                    let respuesta = new Object (resp.results[i])
                    let title = respuesta.title
                    if (title == $("#titulolibro").val())
                    {
                        let pos = i;
                    }
                   }
                   $("#resultados").append(resp);

                    
                });
        });
    </script>
</body>
</html>